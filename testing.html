<!doctype html>
<html class="no-js" lang="zh-CN" data-content_root="./">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="索引" href="genindex.html" /><link rel="search" title="搜索" href="search.html" /><link rel="next" title="API 参考" href="api.html" /><link rel="prev" title="接收操作系统信号" href="signals.html" />

    <!-- Generated with Sphinx 8.1.3 and Furo 2024.08.06 -->
        <title>使用 AnyIO 进行测试 - AnyIO 4.6.2 文档</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/tabs.css?v=a5c4661c" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">AnyIO 4.6.2 文档</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  
  <span class="sidebar-brand-text">AnyIO 4.6.2 文档</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="搜索" name="q" aria-label="搜索">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="basics.html">基础知识</a></li>
<li class="toctree-l1"><a class="reference internal" href="tasks.html">创建和管理任务</a></li>
<li class="toctree-l1"><a class="reference internal" href="cancellation.html">取消和超时</a></li>
<li class="toctree-l1"><a class="reference internal" href="synchronization.html">使用同步原语</a></li>
<li class="toctree-l1"><a class="reference internal" href="streams.html">流</a></li>
<li class="toctree-l1"><a class="reference internal" href="typedattrs.html">使用类型化属性</a></li>
<li class="toctree-l1"><a class="reference internal" href="networking.html">使用套接字和流</a></li>
<li class="toctree-l1"><a class="reference internal" href="threads.html">使用线程</a></li>
<li class="toctree-l1"><a class="reference internal" href="subprocesses.html">使用子进程</a></li>
<li class="toctree-l1"><a class="reference internal" href="fileio.html">异步文件 I/O 支持</a></li>
<li class="toctree-l1"><a class="reference internal" href="signals.html">接收操作系统信号</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">使用 AnyIO 进行测试</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API 参考</a></li>
<li class="toctree-l1"><a class="reference internal" href="migration.html">从 AnyIO 3 迁移到 AnyIO 4</a></li>
<li class="toctree-l1"><a class="reference internal" href="migration.html#anyio-2-anyio-3">从 AnyIO 2 迁移到 AnyIO 3</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">常见问题</a></li>
<li class="toctree-l1"><a class="reference internal" href="support.html">获取帮助</a></li>
<li class="toctree-l1"><a class="reference internal" href="support.html#id2">报告错误</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">为 AnyIO 做出贡献</a></li>
<li class="toctree-l1"><a class="reference internal" href="versionhistory.html">版本历史</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="https://github.com/hellowac/anyio-zh-cn/blob/sync-docs/cn_docs/testing.rst?plain=true" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div><div class="edit-this-page">
  <a class="muted-link" href="https://github.com/hellowac/anyio-zh-cn/edit/sync-docs/cn_docs/testing.rst" title="Edit this page">
    <svg><use href="#svg-pencil"></use></svg>
    <span class="visually-hidden">Edit this page</span>
  </a>
</div><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="anyio">
<h1>使用 AnyIO 进行测试<a class="headerlink" href="#anyio" title="Link to this heading">¶</a></h1>
<p><strong>Testing with AnyIO</strong></p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-0-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-0-0-0" name="0-0" role="tab" tabindex="0">中文</button><button aria-controls="panel-0-0-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-0-0-1" name="0-1" role="tab" tabindex="-1">英文</button></div><div aria-labelledby="tab-0-0-0" class="sphinx-tabs-panel" id="panel-0-0-0" name="0-0" role="tabpanel" tabindex="0"><p>AnyIO 提供了内置支持，用于通过 <a class="reference external" href="https://docs.pytest.org/en/latest/">pytest</a> 插件测试你的库或应用程序。</p>
</div><div aria-labelledby="tab-0-0-1" class="sphinx-tabs-panel" hidden="true" id="panel-0-0-1" name="0-1" role="tabpanel" tabindex="0"><p>AnyIO provides built-in support for testing your library or application in the form of a <a class="reference external" href="https://docs.pytest.org/en/latest/">pytest</a> plugin.</p>
</div></div>
<section id="id1">
<h2>创建异步测试<a class="headerlink" href="#id1" title="Link to this heading">¶</a></h2>
<p><strong>Creating asynchronous tests</strong></p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-1-1-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-1-1-0" name="1-0" role="tab" tabindex="0">中文</button><button aria-controls="panel-1-1-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-1-1-1" name="1-1" role="tab" tabindex="-1">英文</button></div><div aria-labelledby="tab-1-1-0" class="sphinx-tabs-panel" id="panel-1-1-0" name="1-0" role="tabpanel" tabindex="0"><p>Pytest 本身不支持运行异步测试函数，因此需要标记这些函数，以便 AnyIO pytest 插件能够识别它们。可以通过以下两种方式之一来实现：</p>
<ol class="arabic simple">
<li><p>使用 <code class="docutils literal notranslate"><span class="pre">pytest.mark.anyio</span></code> 标记</p></li>
<li><p>使用 <code class="docutils literal notranslate"><span class="pre">anyio_backend</span></code> 固定器，直接使用或通过其他固定器</p></li>
</ol>
<p>最简单的方法是如下所示:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pytest</span>

<span class="c1"># 这与在模块中的所有测试函数上使用 @pytest.mark.anyio 相同</span>
<span class="n">pytestmark</span> <span class="o">=</span> <span class="n">pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">anyio</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">test_something</span><span class="p">():</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>使用此标记标记模块、类或函数，与在它们上应用 <code class="docutils literal notranslate"><span class="pre">pytest.mark.usefixtures('anyio_backend')</span></code> 的效果相同。</p>
<p>因此，你也可以在测试和固定器中直接要求使用该固定器:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pytest</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">test_something</span><span class="p">(</span><span class="n">anyio_backend</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-1-1-1" class="sphinx-tabs-panel" hidden="true" id="panel-1-1-1" name="1-1" role="tabpanel" tabindex="0"><p>Pytest does not natively support running asynchronous test functions, so they have to be
marked for the AnyIO pytest plugin to pick them up. This can be done in one of two ways:</p>
<ol class="arabic simple">
<li><p>Using the <code class="docutils literal notranslate"><span class="pre">pytest.mark.anyio</span></code> marker</p></li>
<li><p>Using the <code class="docutils literal notranslate"><span class="pre">anyio_backend</span></code> fixture, either directly or via another fixture</p></li>
</ol>
<p>The simplest way is thus the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pytest</span>

<span class="c1"># This is the same as using the @pytest.mark.anyio on all test functions in the module</span>
<span class="n">pytestmark</span> <span class="o">=</span> <span class="n">pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">anyio</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">test_something</span><span class="p">():</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>Marking modules, classes or functions with this marker has the same effect as applying
the <code class="docutils literal notranslate"><span class="pre">pytest.mark.usefixtures('anyio_backend')</span></code> on them.</p>
<p>Thus, you can also require the fixture directly in your tests and fixtures:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pytest</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">test_something</span><span class="p">(</span><span class="n">anyio_backend</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
</div></div>
</section>
<section id="id2">
<h2>指定要运行的后端<a class="headerlink" href="#id2" title="Link to this heading">¶</a></h2>
<p><strong>Specifying the backends to run on</strong></p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-2-2-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-2-2-0" name="2-0" role="tab" tabindex="0">中文</button><button aria-controls="panel-2-2-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-2-2-1" name="2-1" role="tab" tabindex="-1">英文</button></div><div aria-labelledby="tab-2-2-0" class="sphinx-tabs-panel" id="panel-2-2-0" name="2-0" role="tabpanel" tabindex="0"><p><code class="docutils literal notranslate"><span class="pre">anyio_backend</span></code> 固定器决定了测试和固定器运行时使用的后端及其选项。AnyIO pytest 插件提供了一个函数作用域的固定器，该固定器的名称为 <code class="docutils literal notranslate"><span class="pre">anyio_backend</span></code>, 它会在所有支持的后端上运行所有内容。</p>
<p>如果你想为整个项目更改后端/选项，可以在顶级的 <code class="docutils literal notranslate"><span class="pre">conftest.py</span></code> 文件中放置如下内容:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">anyio_backend</span><span class="p">():</span>
    <span class="k">return</span> <span class="s1">&#39;asyncio&#39;</span>
</pre></div>
</div>
<p>如果你想为选定的后端指定不同的选项，可以通过传递一个包含（后端名称，选项字典）的元组来实现:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="p">[</span>
    <span class="n">pytest</span><span class="o">.</span><span class="n">param</span><span class="p">((</span><span class="s1">&#39;asyncio&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;use_uvloop&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}),</span> <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;asyncio+uvloop&#39;</span><span class="p">),</span>
    <span class="n">pytest</span><span class="o">.</span><span class="n">param</span><span class="p">((</span><span class="s1">&#39;asyncio&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;use_uvloop&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}),</span> <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;asyncio&#39;</span><span class="p">),</span>
    <span class="n">pytest</span><span class="o">.</span><span class="n">param</span><span class="p">((</span><span class="s1">&#39;trio&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;restrict_keyboard_interrupt_to_checkpoints&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}),</span> <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;trio&#39;</span><span class="p">)</span>
<span class="p">])</span>
<span class="k">def</span> <span class="nf">anyio_backend</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">request</span><span class="o">.</span><span class="n">param</span>
</pre></div>
</div>
<p>如果你需要在特定后端上运行单个测试，可以使用 <code class="docutils literal notranslate"><span class="pre">&#64;pytest.mark.parametrize``（记得将</span> <span class="pre">``anyio_backend</span></code> 参数添加到实际的测试函数中，否则 pytest 会报错）:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s1">&#39;anyio_backend&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;asyncio&#39;</span><span class="p">])</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">test_on_asyncio_only</span><span class="p">(</span><span class="n">anyio_backend</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>由于 <code class="docutils literal notranslate"><span class="pre">anyio_backend</span></code> 固定器可以返回字符串或元组，因此为了方便，你还可以使用以下两个额外的函数作用域固定器（它们本身依赖于 <code class="docutils literal notranslate"><span class="pre">anyio_backend</span></code> 固定器）：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">anyio_backend_name</span></code>：后端的名称（例如 <code class="docutils literal notranslate"><span class="pre">asyncio</span></code>）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">anyio_backend_options</span></code>：用于运行该后端的选项字典</p></li>
</ul>
</div><div aria-labelledby="tab-2-2-1" class="sphinx-tabs-panel" hidden="true" id="panel-2-2-1" name="2-1" role="tabpanel" tabindex="0"><p>The <code class="docutils literal notranslate"><span class="pre">anyio_backend</span></code> fixture determines the backends and their options that tests and
fixtures are run with. The AnyIO pytest plugin comes with a function scoped fixture with
this name which runs everything on all supported backends.</p>
<p>If you change the backends/options for the entire project, then put something like this
in your top level <code class="docutils literal notranslate"><span class="pre">conftest.py</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">anyio_backend</span><span class="p">():</span>
    <span class="k">return</span> <span class="s1">&#39;asyncio&#39;</span>
</pre></div>
</div>
<p>If you want to specify different options for the selected backend, you can do so by
passing a tuple of (backend name, options dict):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="p">[</span>
    <span class="n">pytest</span><span class="o">.</span><span class="n">param</span><span class="p">((</span><span class="s1">&#39;asyncio&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;use_uvloop&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}),</span> <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;asyncio+uvloop&#39;</span><span class="p">),</span>
    <span class="n">pytest</span><span class="o">.</span><span class="n">param</span><span class="p">((</span><span class="s1">&#39;asyncio&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;use_uvloop&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}),</span> <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;asyncio&#39;</span><span class="p">),</span>
    <span class="n">pytest</span><span class="o">.</span><span class="n">param</span><span class="p">((</span><span class="s1">&#39;trio&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;restrict_keyboard_interrupt_to_checkpoints&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}),</span> <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;trio&#39;</span><span class="p">)</span>
<span class="p">])</span>
<span class="k">def</span> <span class="nf">anyio_backend</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">request</span><span class="o">.</span><span class="n">param</span>
</pre></div>
</div>
<p>If you need to run a single test on a specific backend, you can use
<code class="docutils literal notranslate"><span class="pre">&#64;pytest.mark.parametrize</span></code> (remember to add the <code class="docutils literal notranslate"><span class="pre">anyio_backend</span></code> parameter to the
actual test function, or pytest will complain):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s1">&#39;anyio_backend&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;asyncio&#39;</span><span class="p">])</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">test_on_asyncio_only</span><span class="p">(</span><span class="n">anyio_backend</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>Because the <code class="docutils literal notranslate"><span class="pre">anyio_backend</span></code> fixture can return either a string or a tuple, there are
two additional function-scoped fixtures (which themselves depend on the
<code class="docutils literal notranslate"><span class="pre">anyio_backend</span></code> fixture) provided for your convenience:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">anyio_backend_name</span></code>: the name of the backend (e.g. <code class="docutils literal notranslate"><span class="pre">asyncio</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">anyio_backend_options</span></code>: the dictionary of option keywords used to run the backend</p></li>
</ul>
</div></div>
</section>
<section id="id3">
<h2>异步装置<a class="headerlink" href="#id3" title="Link to this heading">¶</a></h2>
<p><strong>Asynchronous fixtures</strong></p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-3-3-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-3-3-0" name="3-0" role="tab" tabindex="0">中文</button><button aria-controls="panel-3-3-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-3-3-1" name="3-1" role="tab" tabindex="-1">英文</button></div><div aria-labelledby="tab-3-3-0" class="sphinx-tabs-panel" id="panel-3-3-0" name="3-0" role="tabpanel" tabindex="0"><p>该插件还支持协程函数作为固定器，用于设置和销毁测试中使用的异步服务。</p>
<p>有两种方法可以让 AnyIO pytest 插件运行你的异步固定器：</p>
<ol class="arabic simple">
<li><p>在启用 AnyIO 的测试中使用它们（参见第一部分）</p></li>
<li><p>在固定器本身中使用 <code class="docutils literal notranslate"><span class="pre">anyio_backend</span></code> 固定器（或任何使用它的其他固定器）</p></li>
</ol>
<p>最简单的方法是使用第一种选项:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pytest</span>

<span class="n">pytestmark</span> <span class="o">=</span> <span class="n">pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">anyio</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">server</span><span class="p">():</span>
    <span class="n">server</span> <span class="o">=</span> <span class="k">await</span> <span class="n">setup_server</span><span class="p">()</span>
    <span class="k">yield</span> <span class="n">server</span>
    <span class="k">await</span> <span class="n">server</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">test_server</span><span class="p">(</span><span class="n">server</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">server</span><span class="o">.</span><span class="n">do_something</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="o">==</span> <span class="s1">&#39;foo&#39;</span>
</pre></div>
</div>
<p>对于 <code class="docutils literal notranslate"><span class="pre">autouse=True</span></code> 的固定器，你可能需要使用另一种方法:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">autouse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">server</span><span class="p">(</span><span class="n">anyio_backend</span><span class="p">):</span>
    <span class="n">server</span> <span class="o">=</span> <span class="k">await</span> <span class="n">setup_server</span><span class="p">()</span>
    <span class="k">yield</span>
    <span class="k">await</span> <span class="n">server</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">test_server</span><span class="p">():</span>
    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">do_something_on_the_server</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="o">==</span> <span class="s1">&#39;foo&#39;</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-3-3-1" class="sphinx-tabs-panel" hidden="true" id="panel-3-3-1" name="3-1" role="tabpanel" tabindex="0"><p>The plugin also supports coroutine functions as fixtures, for the purpose of setting up
and tearing down asynchronous services used for tests.</p>
<p>There are two ways to get the AnyIO pytest plugin to run your asynchronous fixtures:</p>
<ol class="arabic simple">
<li><p>Use them in AnyIO enabled tests (see the first section)</p></li>
</ol>
<p>#. Use the <code class="docutils literal notranslate"><span class="pre">anyio_backend</span></code> fixture (or any other fixture using it) in the fixture
itself</p>
<p>The simplest way is using the first option:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pytest</span>

<span class="n">pytestmark</span> <span class="o">=</span> <span class="n">pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">anyio</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">server</span><span class="p">():</span>
    <span class="n">server</span> <span class="o">=</span> <span class="k">await</span> <span class="n">setup_server</span><span class="p">()</span>
    <span class="k">yield</span> <span class="n">server</span>
    <span class="k">await</span> <span class="n">server</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">test_server</span><span class="p">(</span><span class="n">server</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">server</span><span class="o">.</span><span class="n">do_something</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="o">==</span> <span class="s1">&#39;foo&#39;</span>
</pre></div>
</div>
<p>For <code class="docutils literal notranslate"><span class="pre">autouse=True</span></code> fixtures, you may need to use the other approach:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">autouse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">server</span><span class="p">(</span><span class="n">anyio_backend</span><span class="p">):</span>
    <span class="n">server</span> <span class="o">=</span> <span class="k">await</span> <span class="n">setup_server</span><span class="p">()</span>
    <span class="k">yield</span>
    <span class="k">await</span> <span class="n">server</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">test_server</span><span class="p">():</span>
    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">do_something_on_the_server</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="o">==</span> <span class="s1">&#39;foo&#39;</span>
</pre></div>
</div>
</div></div>
</section>
<section id="id4">
<h2>使用具有更高范围的异步装置<a class="headerlink" href="#id4" title="Link to this heading">¶</a></h2>
<p><strong>Using async fixtures with higher scopes</strong></p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-4-4-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-4-4-0" name="4-0" role="tab" tabindex="0">中文</button><button aria-controls="panel-4-4-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-4-4-1" name="4-1" role="tab" tabindex="-1">英文</button></div><div aria-labelledby="tab-4-4-0" class="sphinx-tabs-panel" id="panel-4-4-0" name="4-0" role="tabpanel" tabindex="0"><p>对于作用域不是 <code class="docutils literal notranslate"><span class="pre">function</span></code> 的异步固定器，你需要定义你自己的 <code class="docutils literal notranslate"><span class="pre">anyio_backend</span></code> 固定器，因为默认的 <code class="docutils literal notranslate"><span class="pre">anyio_backend</span></code> 固定器是函数作用域的:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">scope</span><span class="o">=</span><span class="s1">&#39;module&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">anyio_backend</span><span class="p">():</span>
    <span class="k">return</span> <span class="s1">&#39;asyncio&#39;</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">scope</span><span class="o">=</span><span class="s1">&#39;module&#39;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">server</span><span class="p">(</span><span class="n">anyio_backend</span><span class="p">):</span>
    <span class="n">server</span> <span class="o">=</span> <span class="k">await</span> <span class="n">setup_server</span><span class="p">()</span>
    <span class="k">yield</span>
    <span class="k">await</span> <span class="n">server</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-4-4-1" class="sphinx-tabs-panel" hidden="true" id="panel-4-4-1" name="4-1" role="tabpanel" tabindex="0"><p>For async fixtures with scopes other than <code class="docutils literal notranslate"><span class="pre">function</span></code>, you will need to define your own
<code class="docutils literal notranslate"><span class="pre">anyio_backend</span></code> fixture because the default <code class="docutils literal notranslate"><span class="pre">anyio_backend</span></code> fixture is function
scoped:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">scope</span><span class="o">=</span><span class="s1">&#39;module&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">anyio_backend</span><span class="p">():</span>
    <span class="k">return</span> <span class="s1">&#39;asyncio&#39;</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">scope</span><span class="o">=</span><span class="s1">&#39;module&#39;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">server</span><span class="p">(</span><span class="n">anyio_backend</span><span class="p">):</span>
    <span class="n">server</span> <span class="o">=</span> <span class="k">await</span> <span class="n">setup_server</span><span class="p">()</span>
    <span class="k">yield</span>
    <span class="k">await</span> <span class="n">server</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</pre></div>
</div>
</div></div>
</section>
<section id="id5">
<h2>技术细节<a class="headerlink" href="#id5" title="Link to this heading">¶</a></h2>
<p><strong>Technical details</strong></p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-5-5-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-5-5-0" name="5-0" role="tab" tabindex="0">中文</button><button aria-controls="panel-5-5-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-5-5-1" name="5-1" role="tab" tabindex="-1">英文</button></div><div aria-labelledby="tab-5-5-0" class="sphinx-tabs-panel" id="panel-5-5-0" name="5-0" role="tabpanel" tabindex="0"><p>固定器和测试是由一个“测试运行器”执行的，该运行器为每个后端单独实现。测试运行器在请求期间保持事件循环打开，使得固定器中的代码可以与测试中的代码（以及彼此之间）进行通信。</p>
<p>当第一个匹配的异步测试或固定器即将运行时，测试运行器被创建；当该固定器被拆卸或测试完成时，测试运行器被关闭。因此，如果没有使用更高层次的（作用域为 <code class="docutils literal notranslate"><span class="pre">class</span></code> 或更高）异步固定器，则为每个匹配的测试创建一个单独的测试运行器。相反，如果有至少一个作用域高于 <code class="docutils literal notranslate"><span class="pre">function</span></code> 的异步固定器在所有测试之间共享，则在测试会话期间只会创建一个测试运行器。</p>
</div><div aria-labelledby="tab-5-5-1" class="sphinx-tabs-panel" hidden="true" id="panel-5-5-1" name="5-1" role="tabpanel" tabindex="0"><p>The fixtures and tests are run by a &quot;test runner&quot;, implemented separately for each
backend. The test runner keeps an event loop open during the request, making it possible
for code in fixtures to communicate with the code in the tests (and each other).</p>
<p>The test runner is created when the first matching async test or fixture is about to be
run, and shut down when that same fixture is being torn down or the test has finished
running. As such, if no higher-order (scoped <code class="docutils literal notranslate"><span class="pre">class</span></code> or higher) async fixtures are
used, a separate test runner is created for each matching test. Conversely, if even one
async fixture, scoped higher than <code class="docutils literal notranslate"><span class="pre">function</span></code>, is shared across all tests, only one
test runner will be created during the test session.</p>
</div></div>
<section id="id6">
<h3>上下文变量传播<a class="headerlink" href="#id6" title="Link to this heading">¶</a></h3>
<p><strong>Context variable propagation</strong></p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-6-6-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-6-6-0" name="6-0" role="tab" tabindex="0">中文</button><button aria-controls="panel-6-6-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-6-6-1" name="6-1" role="tab" tabindex="-1">英文</button></div><div aria-labelledby="tab-6-6-0" class="sphinx-tabs-panel" id="panel-6-6-0" name="6-0" role="tabpanel" tabindex="0"><p>异步测试运行器在同一个任务中运行所有异步固定器和测试，因此在异步测试运行器中设置的上下文变量会影响同一运行器中的其他异步固定器和测试。然而，这些上下文变量**不会**被传递到同步测试和固定器，或者其他异步测试运行器。</p>
</div><div aria-labelledby="tab-6-6-1" class="sphinx-tabs-panel" hidden="true" id="panel-6-6-1" name="6-1" role="tabpanel" tabindex="0"><p>The asynchronous test runner runs all async fixtures and tests in the same task, so
context variables set in async fixtures or tests, within an async test runner, will
affect other async fixtures and tests within the same runner. However, these context
variables are <strong>not</strong> carried over to synchronous tests and fixtures, or to other async
test runners.</p>
</div></div>
</section>
<section id="id7">
<h3>与其他异步测试运行器的比较<a class="headerlink" href="#id7" title="Link to this heading">¶</a></h3>
<p><strong>Comparison with other async test runners</strong></p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-7-7-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-7-7-0" name="7-0" role="tab" tabindex="0">中文</button><button aria-controls="panel-7-7-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-7-7-1" name="7-1" role="tab" tabindex="-1">英文</button></div><div aria-labelledby="tab-7-7-0" class="sphinx-tabs-panel" id="panel-7-7-0" name="7-0" role="tabpanel" tabindex="0"><p><code class="docutils literal notranslate"><span class="pre">pytest-asyncio</span></code> 库仅适用于 asyncio 代码。与 AnyIO pytest 插件类似，它可以通过指定更高层次的 <code class="docutils literal notranslate"><span class="pre">event_loop</span></code> 固定器来支持更高层次的固定器。然而，它在每个操作的异步固定器的设置和拆卸阶段都会在一个新的异步任务中运行，这使得上下文变量的传播变得不可能，并且阻止了任务组和取消作用域的正常功能。</p>
<p><code class="docutils literal notranslate"><span class="pre">pytest-trio</span></code> 库用于测试 Trio 项目，仅适用于 Trio 代码。此外，它仅支持函数作用域的异步固定器。与 AnyIO pytest 插件的另一个显著区别是，当异步固定器的依赖图允许时，它会尝试并发地运行异步固定器的设置和拆卸过程。</p>
</div><div aria-labelledby="tab-7-7-1" class="sphinx-tabs-panel" hidden="true" id="panel-7-7-1" name="7-1" role="tabpanel" tabindex="0"><p>The <code class="docutils literal notranslate"><span class="pre">pytest-asyncio</span></code> library only works with asyncio code. Like the AnyIO pytest
plugin, it can be made to support higher order fixtures (by specifying a higher order
<code class="docutils literal notranslate"><span class="pre">event_loop</span></code> fixture). However, it runs the setup and teardown phases of each async
fixture in a new async task per operation, making context variable propagation
impossible and preventing task groups and cancel scopes from functioning properly.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">pytest-trio</span></code> library, made for testing Trio projects, works only with Trio code.
Additionally, it only supports function scoped async fixtures. Another significant
difference with the AnyIO pytest plugin is that attempts to run the setup and teardown
for async fixtures concurrently when their dependency graphs allow that.</p>
</div></div>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="api.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">API 参考</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="signals.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">接收操作系统信号</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2018, Alex Grönholm
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              <a class="muted-link " href="https://github.com/hellowac/anyio-zh-cn" aria-label="GitHub">
                <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path>
                </svg>
            </a>
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">使用 AnyIO 进行测试</a><ul>
<li><a class="reference internal" href="#id1">创建异步测试</a></li>
<li><a class="reference internal" href="#id2">指定要运行的后端</a></li>
<li><a class="reference internal" href="#id3">异步装置</a></li>
<li><a class="reference internal" href="#id4">使用具有更高范围的异步装置</a></li>
<li><a class="reference internal" href="#id5">技术细节</a><ul>
<li><a class="reference internal" href="#id6">上下文变量传播</a></li>
<li><a class="reference internal" href="#id7">与其他异步测试运行器的比较</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="_static/documentation_options.js?v=b0668c51"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/translations.js?v=beaddf03"></script>
    <script src="_static/tabs.js?v=3030b3cb"></script>
    </body>
</html>